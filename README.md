
# YaMDB v.1

## Команда 24:

* Ариуна Эрдэнээ
* Рафис Гайсин
* Аюр Санданов

## Описание проекта

**YaMDB** — это простой и функциональный API, который позволяет каталогизировать художественные произведения и собирать пользовательские отзывы на них. У него простой human-readable интерфейс с фронтендом и минимально функциональная админка с поддержкой модерации.

На данный момент бэкенд поддерживает:

* заполнение базы данных произведениями (фильмы, книги и т. п.)
* редактирование базы произведений администраторами
* создание и редактирование отзывов на произведения от лица пользователей
* создание и редактирование комментариев от лица пользователей на отзывы
* модерация (создание и удаление) отзывов и комментариев модераторами
* создание профилей пользователей, модераторов и администраторов с помощью кода подтверждения на email
* аутентикацию пользователей по JWT Bearer Token и разные права для всех типов пользователей

В проекте использованы фреймворки Django и Django REST, аутентикация пользователей с помощью Simple JWT, фильтрующие бэкенды django-filters.

## Установка и развертывание

Чтобы развернуть этот проект на локальной машине, следует:

1. Клонировать репозиторий api_yamdb

2. Создать виртуальное окружение в папке проекта:
```
python -m venv venv
```
***Внимание! Обязательно активировать виртуальное окружение:***
```
source venv/Scripts/activate
```

3. Установить зависимости проекта из requirements.txt (подождите, пока pip закончит):
```
pip install -r requirements.txt
```
> NB: не забудьте выбрать в вашем IDE интерпретатор Python из виртуального окружения.

4. Зайти в папку api_yamdb/api_yamdb (там, где находится файл manage.py) и осуществить миграции базы данных:
```
python manage.py makemigrations
python manage.py migrate
```
> Если что-то пошло не так, попробуйте создать миграции для каждого приложения Django отдельно: makemigrations reviews, makemigrations api.

5. Чтобы было на что смотреть и на что писать отзывы и комментарии, заполните базу данных из подготовленных CSV-файлов. Для этого в проекте есть специальный удобный скрипт csv_load:
```
python manage.py csv_load
```

6. Наконец, создайте «суперюзера» — пользователя с максимальными правами. Это нужно, чтобы зайти в админку и при необходимости создать других пользователей с правами, позволяющими увидеть все функции проекта. Введите в терминале:

```
python manage.py createsuperuser
```
> Введите логин и пароль «главного администратора» и существующий адрес почты. Впрочем, код подтверждения вы сможете потом найти и в админке, даже если отсылка писем не работает.

**Теперь вы можете запустить проект!**

```
python manage.py runserver
```

Пока сервер запущен (в терминале вы можете видеть его статус, когда вы что-то с ним делаете), он будет ждать ваших команд по адресу 127.0.0.1:8000/. 

> 127.0.0.1 — это IP-адрес, по которому любой компьютер обращается к самому себе.

Если вы хотите сверить работу API с техническим заданием, откройте эту страницу в браузере:

```
127.0.0.1:8000/redoc/
```

## Админка и аутентификация

Чтобы увидеть все страницы проекта, придётся сначала получить токен аутентикации JWT. Для этого зайдите в **панель администрирования Django**. В этом проекте она полностью настроена и доступна по этому адресу:
```
127.0.0.1:8000/api/v1/admin/
```
Авторизуйтесь в панели администратора с логином и паролем суперюзера. Ваша задача — создать JWT-токен. Для этого с помощью CURL или Postman отправьте в теле JSON запроса POST на эндпойнт /users/create/:

```
{
    "email": "<адрес_почты>",
    "username": "<имя_пользователя>"
}
>>> http://127.0.0.1:8000/api/v1/auth/signup/
```

В почте или в панели администрировния пользователей вы увидите код подтверждения для регистрации. Теперь нужно получить токен аутентикации (POST-запрос):
```
{
    "username": "<имя_пользователя>",
    "confirmation_code": "<код_подтверждения>"
}
>>> http://127.0.0.1:8000/api/v1/auth/token/
```
И вот теперь вы получили токен аутентикации. Его нужно вставить в поле Authorization заголовка запроса (Headers), с префиксом Bearer. Статус пользователя (пользователь, модератор, администратор) вы можете изменить в админке.

## Примеры запросов к API

Этот учебный API построен на Django REST Framework и реализован на вьюсетах, поэтому его эндпойнты простые и предсказуемые. Вы можете увидеть, как они настроены (большая часть — с помощью роутера) в файле urls.py приложения api, то есть в папке api внутри папки проекта.

### Произведения

Чтобы получить ленту всех произведений в базе, сделайте запрос GET (читать её могут в том числе анонимы):
```
127.0.0.1:8000/api/v1/titles/
```
> адрес формата _api/v1_ нужен по двум причинам: с папкой api легче изолировать API от другого содержимого сервера (с помощью прав доступа типа CORS), а _v1_ — это версия API, чтобы можно было одновременно поддерживать старую и новую.

Лента произведений будет пагинирована. Вы можете переходить на страницы с помощью ссылок в теле ответа или с помощью query parameter в URL.
```
127.0.0.1:8000/api/v1/titles/?page=2
```
Чтобы создать новое произведение, сделайте запрос POST на тот же эндпойнт (нужно быть администратором или суперюзером). Чтобы получить или отредактировать отдельное произведение, сделайте запрос с его индексом (id; его вы можете подсмотреть в выдаче ленты постов):
```
127.0.0.1:8000/api/v1/posts/1/
```
> Послав туда же PUT/PATCH-запрос со структурой, аналогичной тому, что вы увидели, можно отредактировать пост (все поля или лишь часть). Для частичной редактуры достаточно послать лишь релевантные поля: какой пост редактировать, DRF поймёт по эндпойнту в URL. Редактировать и удалять (DELETE) произведение может лишь администратор.

С помощью query parameters можно вывести нужные произведения по категории, жанру, году, а также поискать их по имени (в т. ч. с частичным совпадением, **case insensitive**).
```
127.0.0.1:8000/api/v1/titles/?genre=drama
127.0.0.1:8000/api/v1/titles/?category=movie
127.0.0.1:8000/api/v1/titles/?name=властелин
127.0.0.1:8000/api/v1/titles/?year=1984
```

### Категории и жанры

Аналогично произведениям можно посмотреть список категорий и жанров. Они поддерживают поиск по query parameters через название жанра или категории (в т.ч. с частичным совпадением, **case sensitive**)
```
127.0.0.1:8000/api/v1/genres/?search=Баллада
127.0.0.1:8000/api/v1/categories/?search=Филь
```
Редактировать, удалять и создавать новые категории и жанры могут лишь администраторы.

### Отзывы и комментарии

Отзывы могут отставлять все зарегистрированные пользователи, а читать анонимы. Адрес отзывов прямо привязан к адресу произведения:

```
127.0.0.1:8000/api/v1/titles/<title_id>/reviews/
127.0.0.1:8000/api/v1/titles/<title_id>/reviews/<review_id>/
```
> Каждый пользователь может оставить отзыв на произведение лишь один раз. Далее можно лишь редактировать свой отзыв (или удалить его и создать заново). В отзыв входит оценка по 10-балльной шкале; оценки усредняются в рейтинг произведения.

Можно посмотреть конкретный отзыв; автор может отредактировать или удалить свой отзыв или комментарий, а модератор — любые отзывы и комментарии. Адреса комментариев «вложены» в адреса отзывов. По общей ссылке comments для отзыва можно создать новый комментарий (POST)...

```
127.0.0.1:8000/api/v1/titles/11/reviews/22/comments/
127.0.0.1:8000/api/v1/titles/11/reviews/22/comments/1/
```
...а по индивидуальной — отредактировать или удалить (PUT/PATCH/DELETE). Это может сделать лишь автор комментария (либо модератор/администратор/суперюзер).

### Управление учётной записью

Пользователи могут управлять своей учётной записью (а администраторы — получать информацию о пользователях) через API-запросы.

Чтобы посмотреть на свой профильм или изменить его, для пользователя есть эндпойнт users/me:
```
http://127.0.0.1:8000/api/v1/users/me/
```
На него сам пользователь может отправить либо GET-, либо соответствующий по полям PATCH-запрос.

**Остальные страницы о пользователях доступны только администраторам.**
```
127.0.0.1:8000/api/v1/users/ >>> лента всех пользователей и добавление нового
127.0.0.1:8000/api/v1/users/<username>/ >>> информация о пользователе и редактирование
```
По первому эндпойнту можно увидеть пагинированный список пользователей и добавить нового (POST). По второму увидеть одного пользователя и отредактировать или удалить его (PATCH/DELETE).

_Конец документа_
